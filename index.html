<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Memory Pathology Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            width: 100vw;
            height: 100vh;
            background: white;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
            position: relative;
            flex-shrink: 0;
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .previous-answer {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(255,255,255,0.3);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .main-menu {
            padding: 30px 20px;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .menu-button {
            display: block;
            width: 100%;
            padding: 18px;
            margin: 12px 0;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .quiz-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .quiz-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .o-button {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .o-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(17, 153, 142, 0.3);
        }
        
        .x-button {
            background: linear-gradient(135deg, #ee5a24 0%, #fd79a8 100%);
            color: white;
        }
        
        .x-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(238, 90, 36, 0.3);
        }
        
        .folder-selection {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .folder-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .folder-btn {
            padding: 15px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
        }
        
        .folder-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .folder-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .quiz-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .image-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow: hidden;
        }
        
        .quiz-image {
            max-width: 100%;
            max-height: calc(100vh - 200px);
            width: auto;
            height: auto;
            aspect-ratio: 3/4;
            object-fit: contain;
            background: #f0f0f0;
        }
        
        .image-info {
            background: #f8f9ff;
            padding: 8px 15px;
            border-top: 2px solid #667eea;
            flex-shrink: 0;
        }
        
        .image-name {
            font-weight: 500;
            color: #333;
            font-size: 12px;
            text-align: center;
        }
        
        .answer-buttons {
            display: flex;
            gap: 15px;
            padding: 15px 20px;
            flex-shrink: 0;
        }
        
        .answer-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .answer-btn.o {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .answer-btn.x {
            background: linear-gradient(135deg, #ee5a24 0%, #fd79a8 100%);
            color: white;
        }
        
        .answer-btn:hover {
            transform: translateY(-2px);
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            padding: 0 20px 15px;
            flex-shrink: 0;
        }
        
        .control-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: white;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .control-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .hidden {
            display: none;
        }
        
        .back-btn {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .stats {
            background: #f8f9ff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            text-align: center;
        }
        
        .stat-item {
            padding: 10px;
            background: white;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        /* Í∞§Îü≠Ïãú S22 ÌôîÎ©¥ ÎπÑÏú® ÏµúÏ†ÅÌôî */
        @media screen and (max-width: 393px) and (max-height: 851px) {
            .header {
                padding: 12px 20px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .menu-button {
                padding: 15px;
                font-size: 15px;
            }
            
            .answer-btn {
                padding: 12px;
                font-size: 18px;
            }
            
            .control-btn {
                padding: 10px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Menu -->
        <div id="mainMenu" class="screen">
            <div class="header">
                <h1>Memory Pathology</h1>
            </div>
            <div class="main-menu">
                <button class="menu-button quiz-button" onclick="showFolderSelection('quiz')">QUIZ</button>
                <button class="menu-button o-button" onclick="showFolderSelection('o')">üòÅ</button>
                <button class="menu-button x-button" onclick="showFolderSelection('x')">ü§î</button>
                <button class="menu-button" style="background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); color: white;" onclick="showFolderSelection('none')">üòà</button>
                <div class="stats">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="totalImages">0</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="oCount">0</div>
                            <div class="stat-label">üòÅ Marked</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="xCount">0</div>
                            <div class="stat-label">ü§î Marked</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="noneCount">0</div>
                            <div class="stat-label">üòà Unmarked</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Folder Selection -->
        <div id="folderSelection" class="screen hidden">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">‚Üê</button>
                <h1>Select Folder</h1>
            </div>
            <div class="folder-selection">
                <button class="menu-button quiz-button" onclick="startMode('all')">ALL FOLDERS</button>
                <div class="folder-grid">
                    <button class="folder-btn" onclick="startMode('BO_SO')">BO_SO</button>
                    <button class="folder-btn" onclick="startMode('Breast')">Breast</button>
                    <button class="folder-btn" onclick="startMode('Endo')">Endo</button>
                    <button class="folder-btn" onclick="startMode('GI')">GI</button>
                    <button class="folder-btn" onclick="startMode('GU_prostate')">GU_prostate</button>
                    <button class="folder-btn" onclick="startMode('GU_RCC')">GU_RCC</button>
                    <button class="folder-btn" onclick="startMode('GU_UCC')">GU_UCC</button>
                </div>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" class="screen hidden">
            <div class="header">
                <button class="back-btn" onclick="showFolderSelection()">‚Üê</button>
                <h1 id="quizTitle">Quiz Mode</h1>
                <div id="previousAnswer" class="previous-answer hidden"></div>
            </div>
            <div class="quiz-screen">
                <div class="image-container">
                    <img id="quizImage" class="quiz-image" src="" alt="Quiz Image">
                    <div class="image-info">
                        <div class="image-name" id="imageName"></div>
                    </div>
                </div>
                <div id="answerButtons" class="answer-buttons">
                    <button class="answer-btn o" onclick="markAnswer('O')">üòÅ</button>
                    <button class="answer-btn x" onclick="markAnswer('X')">ü§î</button>
                </div>
                <div class="control-buttons">
                    <button class="control-btn" onclick="previousImage()">Ïù¥Ï†Ñ</button>
                    <button class="control-btn" onclick="nextImage()">Îã§Ïùå</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CLOUDINARY_CLOUD_NAME = 'db5wqzdth';
        const FOLDERS = ['BO_SO', 'Breast', 'Endo', 'GI', 'GU_prostate', 'GU_RCC', 'GU_UCC'];
        
        let currentMode = '';
        let selectedFolder = '';
        let currentImageList = [];
        let currentImageIndex = 0;
        let imageHistory = [];
        let answers = JSON.parse(localStorage.getItem('pathologyAnswers') || '{}');
        let imageStats = JSON.parse(localStorage.getItem('imageStats') || '{}');

        // Ïù¥ÎØ∏ÏßÄ URL ÏÉùÏÑ± Ìï®Ïàò
        function getImageUrl(imageName) {
            return `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/image/upload/${imageName}.jpg`;
        }
        
        // GitHubÏóêÏÑú Ïù¥ÎØ∏ÏßÄ Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
        async function fetchImageListFromGitHub() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/hne-ihc/memory_pathology/main/manifest.json');
                if (response.ok) {
                    const imageData = await response.json();
                    console.log('‚úÖ GitHubÏóêÏÑú Ïù¥ÎØ∏ÏßÄ Î™©Î°ù Î°úÎìú ÏÑ±Í≥µ');
                    return imageData;
                }
            } catch (error) {
                console.log('‚ö†Ô∏è GitHubÏóêÏÑú Ïù¥ÎØ∏ÏßÄ Î™©Î°ù Î°úÎìú Ïã§Ìå®, Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©:', error);
            }
            
            // Î∞±ÏóÖÏö© Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ (GitHub ÌååÏùºÏù¥ ÏóÜÏùÑ Îïå)
            return {
                'Breast': [
                    'Breast_1_91_wiaute', 'Breast_2_41_vck5wg', 'Breast_2_16_u6htti', 
                    'Breast_2_40_kq4iy8', 'Breast_2_20_lxlxaf', 'Breast_2_9_xpils9',
                    'Breast_2_17_btqi9d', 'Breast_2_5_i6rfwf', 'Breast_2_12_unbktw',
                    'Breast_2_31_db80cr'
                ],
                'GU_UCC': [
                    'GU_UCC_1_5_khqouy', 'GU_UCC_1_2_grezaz', 'GU_UCC_1_1_rgl0to',
                    'GU_UCC_1_3_y5hkcs', 'GU_UCC_1_4_zf3u6k'
                ],
                'GU_prostate': [
                    'GU_prostate_1_8_czd3pw', 'GU_prostate_1_6_lvfjtd', 'GU_prostate_1_3_cd12xq',
                    'GU_prostate_1_7_mfakk4', 'GU_prostate_1_2_sizcjt', 'GU_prostate_1_5_b4wrpa'
                ],
                'Endo': [
                    'Endo_1_2_p0zhzz', 'Endo_1_1_wsfwf2'
                ],
                'BO_SO': [
                    'BO_SO_1_3_iirlza', 'BO_SO_1_2_j6djon', 'BO_SO_1_1_psnyst'
                ],
                'GI': [],
                'GU_RCC': []
            };
        }

        // Ïù¥ÎØ∏ÏßÄ Ï°¥Ïû¨ ÌôïÏù∏ Î∞è ÎûúÎç§ Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±
        async function generateImageList(folder = 'all') {
            let imageList = [];
            
            if (folder === 'all') {
                // Î™®Îì† Ìè¥ÎçîÏóêÏÑú Ïù¥ÎØ∏ÏßÄ ÏàòÏßë
                for (let folderName of FOLDERS) {
                    const folderImages = await getImagesFromFolder(folderName);
                    imageList = imageList.concat(folderImages);
                }
            } else {
                imageList = await getImagesFromFolder(folder);
            }
            
            return shuffleArray(imageList);
        }

        // ÌäπÏ†ï Ìè¥ÎçîÏóêÏÑú Ïù¥ÎØ∏ÏßÄ ÏàòÏßë
        async function getImagesFromFolder(folderName) {
            // Ï∫êÏãú ÌôïÏù∏
            const cacheKey = `images_${folderName}`;
            const cached = localStorage.getItem(cacheKey);
            const cacheTime = localStorage.getItem(`${cacheKey}_time`);
            
            // Ï∫êÏãúÍ∞Ä ÏûàÍ≥† 30Î∂Ñ Ïù¥ÎÇ¥ÎùºÎ©¥ Ï∫êÏãú ÏÇ¨Ïö©
            if (cached && cacheTime && (Date.now() - parseInt(cacheTime)) < 1800000) {
                console.log(`üì± ${folderName} Ï∫êÏãúÏóêÏÑú Î°úÎìú`);
                return JSON.parse(cached);
            }
            
            // GitHubÏóêÏÑú ÏµúÏã† Ïù¥ÎØ∏ÏßÄ Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
            const imageDatabase = await fetchImageListFromGitHub();
            const folderImages = imageDatabase[folderName] || [];
            
            let images = [];
            for (let imageName of folderImages) {
                images.push({
                    name: imageName,
                    url: getImageUrl(imageName),
                    folder: folderName
                });
            }
            
            // Ï∫êÏãúÏóê Ï†ÄÏû• (30Î∂Ñ)
            localStorage.setItem(cacheKey, JSON.stringify(images));
            localStorage.setItem(`${cacheKey}_time`, Date.now().toString());
            
            console.log(`üìä ${folderName}: ${images.length}Í∞ú Ïù¥ÎØ∏ÏßÄ Î°úÎìúÎê®`);
            return images;
        }

        // Î∞∞Ïó¥ ÏÖûÌîå
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // ÌïÑÌÑ∞Îêú Ïù¥ÎØ∏ÏßÄ Î¶¨Ïä§Ìä∏ ÏÉùÏÑ± (üòÅ, ü§î, üòà ÎßàÌÅ¨Îêú Í≤ÉÎì§)
        function getFilteredImages(answerType) {
            let filtered = [];
            
            if (answerType === 'none') {
                // üòà (ÏïÑÏßÅ ÎãµÎ≥ÄÌïòÏßÄ ÏïäÏùÄ Ïù¥ÎØ∏ÏßÄÎì§)
                const allImages = [];
                // Î™®Îì† Ïù¥ÎØ∏ÏßÄ Î™©Î°ùÏùÑ Í∞ÄÏ†∏ÏôÄÏÑú ÎãµÎ≥ÄÌïòÏßÄ ÏïäÏùÄ Í≤ÉÎì§ Ï∞æÍ∏∞
                for (let folderName of FOLDERS) {
                    const imageDatabase = {
                        'Breast': [
                            'Breast_1_91_wiaute', 'Breast_2_41_vck5wg', 'Breast_2_16_u6htti', 
                            'Breast_2_40_kq4iy8', 'Breast_2_20_lxlxaf', 'Breast_2_9_xpils9',
                            'Breast_2_17_btqi9d', 'Breast_2_5_i6rfwf', 'Breast_2_12_unbktw',
                            'Breast_2_31_db80cr'
                        ],
                        'GU_UCC': [
                            'GU_UCC_1_5_khqouy', 'GU_UCC_1_2_grezaz', 'GU_UCC_1_1_rgl0to',
                            'GU_UCC_1_3_y5hkcs', 'GU_UCC_1_4_zf3u6k'
                        ],
                        'GU_prostate': [
                            'GU_prostate_1_8_czd3pw', 'GU_prostate_1_6_lvfjtd', 'GU_prostate_1_3_cd12xq',
                            'GU_prostate_1_7_mfakk4', 'GU_prostate_1_2_sizcjt', 'GU_prostate_1_5_b4wrpa'
                        ],
                        'Endo': [
                            'Endo_1_2_p0zhzz', 'Endo_1_1_wsfwf2'
                        ],
                        'BO_SO': [
                            'BO_SO_1_3_iirlza', 'BO_SO_1_2_j6djon', 'BO_SO_1_1_psnyst'
                        ],
                        'GI': [],
                        'GU_RCC': []
                    };
                    
                    const folderImages = imageDatabase[folderName] || [];
                    for (let imageName of folderImages) {
                        if (!answers[imageName]) {
                            filtered.push({
                                name: imageName,
                                url: getImageUrl(imageName),
                                folder: folderName
                            });
                        }
                    }
                }
            } else {
                // üòÅ ÎòêÎäî ü§î ÎßàÌÅ¨Îêú Ïù¥ÎØ∏ÏßÄÎì§
                for (let imageName in answers) {
                    if (answers[imageName] === answerType) {
                        // Ìè¥ÎçîÎ™Ö Ï∂îÏ∂ú
                        let folder = '';
                        for (let folderName of FOLDERS) {
                            if (imageName.startsWith(folderName)) {
                                folder = folderName;
                                break;
                            }
                        }
                        
                        filtered.push({
                            name: imageName,
                            url: getImageUrl(imageName),
                            folder: folder
                        });
                    }
                }
            }
            
            return shuffleArray(filtered);
        }

        // ÌôîÎ©¥ Ï†ÑÌôò
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showMainMenu() {
            updateStats();
            showScreen('mainMenu');
        }

        function showFolderSelection(mode) {
            currentMode = mode;
            showScreen('folderSelection');
        }

        // Î™®Îìú ÏãúÏûë
        async function startMode(folder) {
            selectedFolder = folder;
            
            if (currentMode === 'quiz') {
                currentImageList = await generateImageList(folder);
                document.getElementById('quizTitle').textContent = 
                    folder === 'all' ? 'Quiz - All Folders' : `Quiz - ${folder}`;
                document.getElementById('answerButtons').style.display = 'flex';
            } else if (currentMode === 'o') {
                currentImageList = getFilteredImages('O');
                document.getElementById('quizTitle').textContent = 'üòÅ';
                document.getElementById('answerButtons').style.display = 'flex';
            } else if (currentMode === 'x') {
                currentImageList = getFilteredImages('X');
                document.getElementById('quizTitle').textContent = 'ü§î';
                document.getElementById('answerButtons').style.display = 'flex';
            } else if (currentMode === 'none') {
                currentImageList = getFilteredImages('none');
                document.getElementById('quizTitle').textContent = 'üòà';
                document.getElementById('answerButtons').style.display = 'flex';
            }
            
            if (currentImageList.length === 0) {
                alert('Ìï¥Îãπ Ï°∞Í±¥Ïóê ÎßûÎäî Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                showFolderSelection();
                return;
            }
            
            currentImageIndex = 0;
            imageHistory = [0];
            showCurrentImage();
            showScreen('quizScreen');
        }

        // ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄ ÌëúÏãú
        function showCurrentImage() {
            if (currentImageList.length === 0) return;
            
            const currentImage = currentImageList[currentImageIndex];
            const img = document.getElementById('quizImage');
            const nameEl = document.getElementById('imageName');
            const previousAnswer = document.getElementById('previousAnswer');
            
            img.src = currentImage.url;
            nameEl.textContent = currentImage.name;
            
            // Ïù¥Ï†Ñ ÎãµÎ≥Ä ÌëúÏãú
            const prevAnswer = answers[currentImage.name];
            if (prevAnswer && currentMode === 'quiz') {
                const emoji = prevAnswer === 'O' ? 'üòÅ' : 'ü§î';
                previousAnswer.textContent = `Previous: ${emoji}`;
                previousAnswer.classList.remove('hidden');
            } else {
                previousAnswer.classList.add('hidden');
            }
            
            // Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏóêÎü¨ Ï≤òÎ¶¨
            img.onerror = function() {
                console.log('Image failed to load:', currentImage.url);
                // Ïã§Ï†ú Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏúºÎ©¥ Îã§Ïùå Ïù¥ÎØ∏ÏßÄÎ°ú Ïù¥Îèô
                nextImage();
            };
        }

        // ÎãµÎ≥Ä ÎßàÌÇπ
        function markAnswer(answer) {
            if (currentImageList.length === 0) return;
            
            const currentImage = currentImageList[currentImageIndex];
            answers[currentImage.name] = answer;
            
            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            if (!imageStats[currentImage.name]) {
                imageStats[currentImage.name] = 0;
            }
            imageStats[currentImage.name]++;
            
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ Ï†ÄÏû•
            localStorage.setItem('pathologyAnswers', JSON.stringify(answers));
            localStorage.setItem('imageStats', JSON.stringify(imageStats));
            
            // Îã§Ïùå Ïù¥ÎØ∏ÏßÄÎ°ú Ïù¥Îèô
            setTimeout(() => {
                nextImage();
            }, 300);
        }

        // Îã§Ïùå Ïù¥ÎØ∏ÏßÄ
        function nextImage() {
            if (currentImageList.length === 0) return;
            
            // Í∑†Îì±Ìïú ÎπàÎèÑÎ°ú Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù
            currentImageIndex = selectNextImageIndex();
            imageHistory.push(currentImageIndex);
            
            // ÌûàÏä§ÌÜ†Î¶¨ ÌÅ¨Í∏∞ Ï†úÌïú
            if (imageHistory.length > 50) {
                imageHistory = imageHistory.slice(-50);
            }
            
            showCurrentImage();
        }

        // Ïù¥Ï†Ñ Ïù¥ÎØ∏ÏßÄ
        function previousImage() {
            if (imageHistory.length > 1) {
                imageHistory.pop(); // ÌòÑÏû¨ Ïù∏Îç±Ïä§ Ï†úÍ±∞
                currentImageIndex = imageHistory[imageHistory.length - 1];
                showCurrentImage();
            }
        }

        // Í∑†Îì±Ìïú ÎπàÎèÑÎ°ú Îã§Ïùå Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù
        function selectNextImageIndex() {
            // ÌÜµÍ≥Ñ Í∏∞Î∞òÏúºÎ°ú Í∞ÄÏû• Ï†ÅÍ≤å Î≥∏ Ïù¥ÎØ∏ÏßÄÎì§ Ï§ëÏóêÏÑú ÏÑ†ÌÉù
            let minViews = Infinity;
            let candidateIndices = [];
            
            for (let i = 0; i < currentImageList.length; i++) {
                const imageName = currentImageList[i].name;
                const views = imageStats[imageName] || 0;
                
                if (views < minViews) {
                    minViews = views;
                    candidateIndices = [i];
                } else if (views === minViews) {
                    candidateIndices.push(i);
                }
            }
            
            // ÌõÑÎ≥¥ Ï§ëÏóêÏÑú ÎûúÎç§ ÏÑ†ÌÉù
            return candidateIndices[Math.floor(Math.random() * candidateIndices.length)];
        }

        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateStats() {
            let totalImages = Object.keys(imageStats).length;
            let oCount = 0;
            let xCount = 0;
            
            for (let imageName in answers) {
                if (answers[imageName] === 'O') oCount++;
                if (answers[imageName] === 'X') xCount++;
            }
            
            // Ï†ÑÏ≤¥ Ïù¥ÎØ∏ÏßÄ Ïàò Í≥ÑÏÇ∞ (ÌïòÎìúÏΩîÎî©Îêú Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ÏóêÏÑú)
            const allImageDatabase = {
                'Breast': [
                    'Breast_1_91_wiaute', 'Breast_2_41_vck5wg', 'Breast_2_16_u6htti', 
                    'Breast_2_40_kq4iy8', 'Breast_2_20_lxlxaf', 'Breast_2_9_xpils9',
                    'Breast_2_17_btqi9d', 'Breast_2_5_i6rfwf', 'Breast_2_12_unbktw',
                    'Breast_2_31_db80cr'
                ],
                'GU_UCC': [
                    'GU_UCC_1_5_khqouy', 'GU_UCC_1_2_grezaz', 'GU_UCC_1_1_rgl0to',
                    'GU_UCC_1_3_y5hkcs', 'GU_UCC_1_4_zf3u6k'
                ],
                'GU_prostate': [
                    'GU_prostate_1_8_czd3pw', 'GU_prostate_1_6_lvfjtd', 'GU_prostate_1_3_cd12xq',
                    'GU_prostate_1_7_mfakk4', 'GU_prostate_1_2_sizcjt', 'GU_prostate_1_5_b4wrpa'
                ],
                'Endo': [
                    'Endo_1_2_p0zhzz', 'Endo_1_1_wsfwf2'
                ],
                'BO_SO': [
                    'BO_SO_1_3_iirlza', 'BO_SO_1_2_j6djon', 'BO_SO_1_1_psnyst'
                ],
                'GI': [],
                'GU_RCC': []
            };
            
            let allImagesCount = 0;
            for (let folder in allImageDatabase) {
                allImagesCount += allImageDatabase[folder].length;
            }
            
            let noneCount = allImagesCount - oCount - xCount;
            
            document.getElementById('totalImages').textContent = allImagesCount;
            document.getElementById('oCount').textContent = oCount;
            document.getElementById('xCount').textContent = xCount;
            document.getElementById('noneCount').textContent = noneCount;
        }

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
        });
    </script>
</body>
</html>
